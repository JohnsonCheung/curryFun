/// <reference path="./typings/node/node.d.ts"/>
'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
const cf = require("./curryfun.js");
//!export
exports.fTstJs_updMainTstIfStmt = (_fTstJs) => exports.fts_updMainTstIfStmt(cf.fTstJs_fts(_fTstJs));
exports.fjs_updFtsMainTstIfStmt = (_fjs) => exports.fts_updMainTstIfStmt(cf.ffnFts(_fjs));
exports.fts_updMainTstIfStmt = (_fts) => {
    // assume: [ module.id | function tst__* ]
    // aim:    [ upd module.id ]
    // assume[module.id]: each fts (*.ts-file), there is a statement of
    //       : if(module.id==='.') {
    //       : ..           <-- {context}
    //       : }
    // assume[function tst__*]: each fts, there are some /^function (tst__[\w$0-0_])\(\)/
    // aim:[upd module.id]: update the {context} by list of tst__xxxx
    const oldLines = cf.ftLines(_fts);
    const newLines = exports.xn_newLines(oldLines);
    if (newLines !== null && newLines !== oldLines) {
        //cf.ffnMakBackup(_fts)
        cf.sWrt(_fts)(newLines);
    }
};
//!lib ===========
exports.funLin_funNm = (_funLin) => {
    const m0 = _funLin.match(cf.reExpConstNm);
    if (m0 !== null)
        return m0[1];
    const m1 = _funLin.match(cf.reConstNm);
    if (m1 !== null)
        return m1[1];
    cf.er('Given _funLin is not a function-line', { _funLin });
    return '';
};
exports.funLin_part2 = (_funLin) => {
    const a0 = cf.sRmvPfx('export ')(_funLin);
    const a1 = cf.sRmvPfx('const ')(a0);
    const a2 = cf.sRmvFstTerm(a1);
    return ' // ' + a2;
};
exports.srcLy_funLy = (_src) => cf.itrWhere(exports.lin_isFunLin)(_src);
exports.lin_isFunLin = (_lin) => {
    const z = cf.reConstNm.test(_lin) || cf.reExpConstNm.test(_lin);
    //    if(cf.sHasPfx('const')(_lin)) {
    //        console.log(z,_lin)
    //    }
    return z;
};
//!x
exports.xn_newLines = (newLines) => {
    const ly = cf.sSplitLines(newLines);
    const ix1 = exports.x1_ix1(ly);
    const ix2 = exports.x2_ix2(ly, ix1);
    if (ix1 === null || ix2 === null)
        return null;
    const p1 = exports.xn1_part1(ly, ix1);
    const p2 = exports.xn2_part2(ly, ix1, ix2);
    const p3 = exports.xn3_part3(ly, ix2);
    return p1 + '\r\n' + p2 + '\r\n' + p3;
};
exports.x1e_eq = cf.vEQ("if (module.id === '.') {");
exports.x1_ix1 = (ly) => cf.ayFindIx(exports.x1e_eq)(ly);
exports.x2_ix2 = (ly, ix1) => {
    if (ix1 === null)
        return null;
    for (let ix = ix1 + 1; ix < ly.length; ix++) {
        if (ly[ix] === '}')
            return ix;
    }
    return null;
};
exports.xn1_part1 = (ly, ix1) => ly.slice(0, ix1 + 1).join('\r\n');
exports.xn2_part2 = (ly, ix1, ix2) => {
    const tstNy = exports.xn2t_srtedTstFunNy(ly);
    const funLy = exports.xn2f_srtedFunLy(ly);
    const t1 = cf.itrAddPfxSfx('    ', '()')(tstNy);
    const f1 = cf.itrAddPfx('    ')(funLy);
    const n = t1.concat(f1);
    return n.join('\r\n');
};
exports.xn2tsn_nLvl = (ny) => cf.itrMax(cf.itrMap(exports.y_nm_lvlI)(ny));
exports.xn2tsli_isLvlINm = (_lvlI) => (_tstFunNm) => {
    const nm = cf.sRmvPfx('tst__')(_tstFunNm);
    const lvlI = exports.y_nm_lvlI(nm);
    const z = lvlI === _lvlI;
    return z;
};
exports.xn2tsl_lvlINy = (lvlI, ny) => cf.itrWhere(exports.xn2tsli_isLvlINm(lvlI))(ny).sort();
exports.xn3_part3 = (ly, ix2) => ly.slice(ix2).join('\r\n');
exports.xn2ts_srtedTstFunNy = (_tstFunNy) => {
    const ny = cf.itrMap(cf.sRmvPfx("tst__"))(_tstFunNy);
    const n0 = exports.xn2tsn_nLvl(ny);
    const n = cf.vDft(0)(n0);
    let o = [];
    for (let lvlI = n; lvlI >= -1; lvlI--) {
        const m = exports.xn2tsl_lvlINy(lvlI, _tstFunNy);
        o = o.concat(m);
    }
    if (_tstFunNy.length !== o.length) {
        debugger;
        cf.er('_ny.length should = o.length', { _tstFunNy, o });
    }
    return o;
};
exports.xn2t_srtedTstFunNy = (_ly) => {
    const ny = cf.srcCol(/^function (tst__[$a-zA-Z][$_0-9a-zA-Z]*)\(\)/)(_ly);
    return exports.xn2ts_srtedTstFunNy(ny);
};
exports.xn2f_srtedFunLy = (_srcLy) => {
    const v1 = false;
    if (v1)
        return exports.xn2fn_srtedFunNy(_srcLy);
    return exports.xn2fl_srtedFunLy(_srcLy);
};
exports.xn2fl_srtedFunLy = (_srcLy) => {
    const funLy = exports.srcLy_funLy(_srcLy);
    const funNy = cf.itrMap(exports.funLin_funNm)(funLy);
    const part2Ay = cf.itrMap(exports.funLin_part2)(funLy);
    const funNy1 = cf.itrAlignL(funNy);
    const lin = i => funNy1[i] + part2Ay[i];
    const ly = cf.itrMap(lin)(cf.nItr(funNy.length));
    return ly.sort(exports.y_funNmCmpr);
};
exports.xn2fdbf_funNm = (_lin) => {
    const m = _lin.match(cf.reConstNm);
    if (m === null)
        return '';
    return m[1];
};
exports.xn2fdbr_rmk = (_lin) => {
    const m = _lin.match(/\/\/(.*)$/);
    if (m === null)
        return '';
    return m[1].trim();
};
exports.xn2fdb_brk = (_lin) => {
    const funNm = exports.xn2fdbf_funNm(_lin);
    const rmk = exports.xn2fdbr_rmk(_lin);
    return [funNm, rmk];
};
exports.xn2fn_srtedFunNy = (_ly) => {
    const n1 = cf.srcExpConstNy(_ly);
    const n2 = cf.srcConstNy(_ly);
    return n1.concat(n2).sort(exports.y_funNmCmpr);
};
//!y ====================
exports.y_funNmCmpr = (a, b) => cf.vvCompare(a.replace(/\_/g, ' '), b.replace(/\_/g, ' '));
exports.y_nm_lvlI = (nm) => {
    const c0 = nm[0];
    if (c0 !== 'x' && c0 !== 'y')
        return -1;
    const ix = nm.indexOf("_");
    if (ix === -1)
        return -1;
    return ix - 1;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NhblBnbS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNjYW5QZ20udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsZ0RBQWdEO0FBQ2hELFlBQVksQ0FBQTs7QUFDWixvQ0FBbUM7QUFFbkMsU0FBUztBQUNJLFFBQUEsdUJBQXVCLEdBQUcsQ0FBQyxPQUFlLEVBQVEsRUFBRSxDQUFDLDRCQUFvQixDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQTtBQUNqRyxRQUFBLHVCQUF1QixHQUFHLENBQUMsSUFBUyxFQUFRLEVBQUUsQ0FBQyw0QkFBb0IsQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7QUFDcEYsUUFBQSxvQkFBb0IsR0FBRyxDQUFDLElBQVMsRUFBUSxFQUFFO0lBQ3BELDBDQUEwQztJQUMxQyw0QkFBNEI7SUFDNUIsbUVBQW1FO0lBQ25FLGdDQUFnQztJQUNoQyxxQ0FBcUM7SUFDckMsWUFBWTtJQUNaLHFGQUFxRjtJQUNyRixpRUFBaUU7SUFDakUsTUFBTSxRQUFRLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUNqQyxNQUFNLFFBQVEsR0FBRyxtQkFBVyxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQ3RDLEVBQUUsQ0FBQyxDQUFDLFFBQVEsS0FBSyxJQUFJLElBQUksUUFBUSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDN0MsdUJBQXVCO1FBQ3ZCLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUE7SUFDM0IsQ0FBQztBQUNMLENBQUMsQ0FBQTtBQUNELGtCQUFrQjtBQUNMLFFBQUEsWUFBWSxHQUFHLENBQUMsT0FBWSxFQUFNLEVBQUU7SUFDN0MsTUFBTSxFQUFFLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLENBQUE7SUFDekMsRUFBRSxDQUFDLENBQUMs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WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi90eXBpbmdzL25vZGUvbm9kZS5kLnRzXCIvPlxyXG4ndXNlIHN0cmljdCdcclxuaW1wb3J0ICogYXMgY2YgZnJvbSAnLi9jdXJyeWZ1bi5qcydcclxuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnXHJcbi8vIWV4cG9ydFxyXG5leHBvcnQgY29uc3QgZlRzdEpzX3VwZE1haW5Uc3RJZlN0bXQgPSAoX2ZUc3RKczogZlRzdEpzKTogdm9pZCA9PiBmdHNfdXBkTWFpblRzdElmU3RtdChjZi5mVHN0SnNfZnRzKF9mVHN0SnMpKVxyXG5leHBvcnQgY29uc3QgZmpzX3VwZEZ0c01haW5Uc3RJZlN0bXQgPSAoX2ZqczogZmpzKTogdm9pZCA9PiBmdHNfdXBkTWFpblRzdElmU3RtdChjZi5mZm5GdHMoX2ZqcykpXHJcbmV4cG9ydCBjb25zdCBmdHNfdXBkTWFpblRzdElmU3RtdCA9IChfZnRzOiBmdHMpOiB2b2lkID0+IHtcclxuICAgIC8vIGFzc3VtZTogWyBtb2R1bGUuaWQgfCBmdW5jdGlvbiB0c3RfXyogXVxyXG4gICAgLy8gYWltOiAgICBbIHVwZCBtb2R1bGUuaWQgXVxyXG4gICAgLy8gYXNzdW1lW21vZHVsZS5pZF06IGVhY2ggZnRzICgqLnRzLWZpbGUpLCB0aGVyZSBpcyBhIHN0YXRlbWVudCBvZlxyXG4gICAgLy8gICAgICAgOiBpZihtb2R1bGUuaWQ9PT0nLicpIHtcclxuICAgIC8vICAgICAgIDogLi4gICAgICAgICAgIDwtLSB7Y29udGV4dH1cclxuICAgIC8vICAgICAgIDogfVxyXG4gICAgLy8gYXNzdW1lW2Z1bmN0aW9uIHRzdF9fKl06IGVhY2ggZnRzLCB0aGVyZSBhcmUgc29tZSAvXmZ1bmN0aW9uICh0c3RfX1tcXHckMC0wX10pXFwoXFwpL1xyXG4gICAgLy8gYWltOlt1cGQgbW9kdWxlLmlkXTogdXBkYXRlIHRoZSB7Y29udGV4dH0gYnkgbGlzdCBvZiB0c3RfX3h4eHhcclxuICAgIGNvbnN0IG9sZExpbmVzID0gY2YuZnRMaW5lcyhfZnRzKVxyXG4gICAgY29uc3QgbmV3TGluZXMgPSB4bl9uZXdMaW5lcyhvbGRMaW5lcylcclxuICAgIGlmIChuZXdMaW5lcyAhPT0gbnVsbCAmJiBuZXdMaW5lcyAhPT0gb2xkTGluZXMpIHtcclxuICAgICAgICAvL2NmLmZmbk1ha0JhY2t1cChfZnRzKVxyXG4gICAgICAgIGNmLnNXcnQoX2Z0cykobmV3TGluZXMpXHJcbiAgICB9XHJcbn1cclxuLy8hbGliID09PT09PT09PT09XHJcbmV4cG9ydCBjb25zdCBmdW5MaW5fZnVuTm0gPSAoX2Z1bkxpbjogbGluKTogbm0gPT4ge1xyXG4gICAgY29uc3QgbTAgPSBfZnVuTGluLm1hdGNoKGNmLnJlRXhwQ29uc3RObSlcclxuICAgIGlmIChtMCAhPT0gbnVsbClcclxuICAgICAgICByZXR1cm4gbTBbMV1cclxuICAgIGNvbnN0IG0xID0gX2Z1bkxpbi5tYXRjaChjZi5yZUNvbnN0Tm0pXHJcbiAgICBpZiAobTEgIT09IG51bGwpXHJcbiAgICAgICAgcmV0dXJuIG0xWzFdXHJcbiAgICBjZi5lcignR2l2ZW4gX2Z1bkxpbiBpcyBub3QgYSBmdW5jdGlvbi1saW5lJywgeyBfZnVuTGluIH0pXHJcbiAgICByZXR1cm4gJydcclxufVxyXG5leHBvcnQgY29uc3QgZnVuTGluX3BhcnQyID0gKF9mdW5MaW46IGxpbik6IHMgPT4ge1xyXG4gICAgY29uc3QgYTAgPSBjZi5zUm12UGZ4KCdleHBvcnQgJykoX2Z1bkxpbilcclxuICAgIGNvbnN0IGExID0gY2Yuc1JtdlBmeCgnY29uc3QgJykoYTApXHJcbiAgICBjb25zdCBhMiA9IGNmLnNSbXZGc3RUZXJtKGExKVxyXG4gICAgcmV0dXJuICcgLy8gJyArIGEyXHJcbn1cclxuZXhwb3J0IGNvbnN0IHNyY0x5X2Z1bkx5ID0gKF9zcmM6IHNyYyk6IGx5ID0+IGNmLml0cldoZXJlKGxpbl9pc0Z1bkxpbikoX3NyYylcclxuZXhwb3J0IGNvbnN0IGxpbl9pc0Z1bkxpbiA9IChfbGluOiBsaW4pOiBiID0+IHtcclxuICAgIGNvbnN0IHogPSBjZi5yZUNvbnN0Tm0udGVzdChfbGluKSB8fCBjZi5yZUV4cENvbnN0Tm0udGVzdChfbGluKVxyXG4gICAgLy8gICAgaWYoY2Yuc0hhc1BmeCgnY29uc3QnKShfbGluKSkge1xyXG4gICAgLy8gICAgICAgIGNvbnNvbGUubG9nKHosX2xpbilcclxuICAgIC8vICAgIH1cclxuICAgIHJldHVybiB6XHJcbn1cclxuLy8heFxyXG5leHBvcnQgY29uc3QgeG5fbmV3TGluZXMgPSAobmV3TGluZXM6IGxpbmVzKTogbGluZXMgfCBudWxsID0+IHtcclxuICAgIGNvbnN0IGx5ID0gY2Yuc1NwbGl0TGluZXMobmV3TGluZXMpXHJcbiAgICBjb25zdCBpeDEgPSB4MV9peDEobHkpXHJcbiAgICBjb25zdCBpeDIgPSB4Ml9peDIobHksIGl4MSlcclxuICAgIGlmIChpeDEgPT09IG51bGwgfHwgaXgyID09PSBudWxsKVxyXG4gICAgICAgIHJldHVybiBudWxsXHJcbiAgICBjb25zdCBwMSA9IHhuMV9wYXJ0MShseSwgaXgxIGFzIG51bWJlcilcclxuICAgIGNvbnN0IHAyID0geG4yX3BhcnQyKGx5LCBpeDEsIGl4MilcclxuICAgIGNvbnN0IHAzID0geG4zX3BhcnQzKGx5LCBpeDIpXHJcbiAgICByZXR1cm4gcDEgKyAnXFxyXFxuJyArIHAyICsgJ1xcclxcbicgKyBwM1xyXG59XHJcbnR5cGUgaXggPSBudW1iZXIgfCBudWxsXHJcbmV4cG9ydCBjb25zdCB4MWVfZXEgPSBjZi52RVEoXCJpZiAobW9kdWxlLmlkID09PSAnLicpIHtcIilcclxuZXhwb3J0IGNvbnN0IHgxX2l4MSA9IChseTogbHkpOiBpeCA9PiBjZi5heUZpbmRJeCh4MWVfZXEpKGx5KVxyXG5leHBvcnQgY29uc3QgeDJfaXgyID0gKGx5OiBseSwgaXgxOiBpeCk6IGl4ID0+IHtcclxuICAgIGlmIChpeDEgPT09IG51bGwpXHJcbiAgICAgICAgcmV0dXJuIG51bGxcclxuICAgIGZvciAobGV0IGl4ID0gaXgxICsgMTsgaXggPCBseS5sZW5ndGg7IGl4KyspIHtcclxuICAgICAgICBpZiAobHlbaXhdID09PSAnfScpXHJcbiAgICAgICAgICAgIHJldHVybiBpeFxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGxcclxufVxyXG5leHBvcnQgY29uc3QgeG4xX3BhcnQxID0gKGx5OiBseSwgaXgxOiBuKTogbGluZXMgPT4gbHkuc2xpY2UoMCwgaXgxICsgMSkuam9pbignXFxyXFxuJylcclxuZXhwb3J0IGNvbnN0IHhuMl9wYXJ0MiA9IChseTogbHksIGl4MTogbiwgaXgyOiBuKTogbGluZXMgPT4ge1xyXG4gICAgY29uc3QgdHN0TnkgPSB4bjJ0X3NydGVkVHN0RnVuTnkobHkpXHJcbiAgICBjb25zdCBmdW5MeSA9IHhuMmZfc3J0ZWRGdW5MeShseSlcclxuICAgIGNvbnN0IHQxID0gY2YuaXRyQWRkUGZ4U2Z4KCcgICAgJywgJygpJykodHN0TnkpXHJcbiAgICBjb25zdCBmMSA9IGNmLml0ckFkZFBmeCgnICAgICcpKGZ1bkx5KVxyXG4gICAgY29uc3QgbiA9IHQxLmNvbmNhdChmMSlcclxuICAgIHJldHVybiBuLmpvaW4oJ1xcclxcbicpXHJcbn1cclxuZXhwb3J0IGNvbnN0IHhuMnRzbl9uTHZsID0gKG55OiBueSkgPT4gY2YuaXRyTWF4KGNmLml0ck1hcCh5X25tX2x2bEkpKG55KSlcclxuZXhwb3J0IGNvbnN0IHhuMnRzbGlfaXNMdmxJTm0gPSAoX2x2bEk6IG4pID0+IChfdHN0RnVuTm06IG5tKTogYiA9PiB7XHJcbiAgICBjb25zdCBubSA9IGNmLnNSbXZQZngoJ3RzdF9fJykoX3RzdEZ1bk5tKVxyXG4gICAgY29uc3QgbHZsSSA9IHlfbm1fbHZsSShubSlcclxuICAgIGNvbnN0IHogPSBsdmxJID09PSBfbHZsSVxyXG4gICAgcmV0dXJuIHpcclxufVxyXG5leHBvcnQgY29uc3QgeG4ydHNsX2x2bElOeSA9IChsdmxJOiBuLCBueTogbnkpOiBueSA9PiBjZi5pdHJXaGVyZSh4bjJ0c2xpX2lzTHZsSU5tKGx2bEkpKShueSkuc29ydCgpXHJcbmV4cG9ydCBjb25zdCB4bjNfcGFydDMgPSAobHk6IGx5LCBpeDI6IG4pOiBsaW5lcyA9PiBseS5zbGljZShpeDIpLmpvaW4oJ1xcclxcbicpXHJcbmV4cG9ydCBjb25zdCB4bjJ0c19zcnRlZFRzdEZ1bk55ID0gKF90c3RGdW5OeTogbnkpOiBubVtdID0+IHtcclxuICAgIGNvbnN0IG55ID0gY2YuaXRyTWFwKGNmLnNSbXZQZngoXCJ0c3RfX1wiKSkoX3RzdEZ1bk55KVxyXG4gICAgY29uc3QgbjAgPSB4bjJ0c25fbkx2bChueSlcclxuICAgIGNvbnN0IG4gPSBjZi52RGZ0KDApKG4wKVxyXG4gICAgbGV0IG86IG55ID0gW11cclxuICAgIGZvciAobGV0IGx2bEkgPSBuOyBsdmxJID49IC0xOyBsdmxJLS0pIHtcclxuICAgICAgICBjb25zdCBtID0geG4ydHNsX2x2bElOeShsdmxJLCBfdHN0RnVuTnkpXHJcbiAgICAgICAgbyA9IG8uY29uY2F0KG0pXHJcbiAgICB9XHJcbiAgICBpZiAoX3RzdEZ1bk55Lmxlbmd0aCAhPT0gby5sZW5ndGgpIHtcclxuICAgICAgICBkZWJ1Z2dlclxyXG4gICAgICAgIGNmLmVyKCdfbnkubGVuZ3RoIHNob3VsZCA9IG8ubGVuZ3RoJywgeyBfdHN0RnVuTnksIG8gfSlcclxuICAgIH1cclxuICAgIHJldHVybiBvXHJcbn1cclxuZXhwb3J0IGNvbnN0IHhuMnRfc3J0ZWRUc3RGdW5OeSA9IChfbHk6IGx5KTogbm1bXSA9PiB7XHJcbiAgICBjb25zdCBueSA9IGNmLnNyY0NvbCgvXmZ1bmN0aW9uICh0c3RfX1skYS16QS1aXVskXzAtOWEtekEtWl0qKVxcKFxcKS8pKF9seSlcclxuICAgIHJldHVybiB4bjJ0c19zcnRlZFRzdEZ1bk55KG55KVxyXG59XHJcbmV4cG9ydCBjb25zdCB4bjJmX3NydGVkRnVuTHkgPSAoX3NyY0x5OiBseSk6IGx5ID0+IHtcclxuICAgIGNvbnN0IHYxID0gZmFsc2VcclxuICAgIGlmICh2MSlcclxuICAgICAgICByZXR1cm4geG4yZm5fc3J0ZWRGdW5OeShfc3JjTHkpXHJcbiAgICByZXR1cm4geG4yZmxfc3J0ZWRGdW5MeShfc3JjTHkpXHJcbn1cclxuZXhwb3J0IGNvbnN0IHhuMmZsX3NydGVkRnVuTHkgPSAoX3NyY0x5OiBseSk6IGx5ID0+IHtcclxuICAgIGNvbnN0IGZ1bkx5ID0gc3JjTHlfZnVuTHkoX3NyY0x5KVxyXG4gICAgY29uc3QgZnVuTnkgPSBjZi5pdHJNYXAoZnVuTGluX2Z1bk5tKShmdW5MeSlcclxuICAgIGNvbnN0IHBhcnQyQXkgPSBjZi5pdHJNYXAoZnVuTGluX3BhcnQyKShmdW5MeSlcclxuICAgIGNvbnN0IGZ1bk55MSA9IGNmLml0ckFsaWduTChmdW5OeSlcclxuICAgIGNvbnN0IGxpbiA9IGkgPT4gZnVuTnkxW2ldICsgcGFydDJBeVtpXVxyXG4gICAgY29uc3QgbHkgPSBjZi5pdHJNYXAobGluKShjZi5uSXRyKGZ1bk55Lmxlbmd0aCkpXHJcbiAgICByZXR1cm4gbHkuc29ydCh5X2Z1bk5tQ21wcilcclxufVxyXG5leHBvcnQgY29uc3QgeG4yZmRiZl9mdW5ObSA9IChfbGluOiBsaW4pOiBubSA9PiB7XHJcbiAgICBjb25zdCBtID0gX2xpbi5tYXRjaChjZi5yZUNvbnN0Tm0pXHJcbiAgICBpZiAobSA9PT0gbnVsbClcclxuICAgICAgICByZXR1cm4gJydcclxuICAgIHJldHVybiBtWzFdXHJcbn1cclxuZXhwb3J0IGNvbnN0IHhuMmZkYnJfcm1rID0gKF9saW46IGxpbik6IHMgPT4ge1xyXG4gICAgY29uc3QgbSA9IF9saW4ubWF0Y2goL1xcL1xcLyguKikkLylcclxuICAgIGlmIChtID09PSBudWxsKVxyXG4gICAgICAgIHJldHVybiAnJ1xyXG4gICAgcmV0dXJuIG1bMV0udHJpbSgpXHJcbn1cclxuZXhwb3J0IGNvbnN0IHhuMmZkYl9icmsgPSAoX2xpbjogbGluKTogW3MsIHNdID0+IHtcclxuICAgIGNvbnN0IGZ1bk5tID0geG4yZmRiZl9mdW5ObShfbGluKVxyXG4gICAgY29uc3Qgcm1rID0geG4yZmRicl9ybWsoX2xpbilcclxuICAgIHJldHVybiBbZnVuTm0sIHJta11cclxufVxyXG5leHBvcnQgY29uc3QgeG4yZm5fc3J0ZWRGdW5OeSA9IChfbHk6IGx5KTogbHkgPT4ge1xyXG4gICAgY29uc3QgbjEgPSBjZi5zcmNFeHBDb25zdE55KF9seSlcclxuICAgIGNvbnN0IG4yID0gY2Yuc3JjQ29uc3ROeShfbHkpXHJcbiAgICByZXR1cm4gbjEuY29uY2F0KG4yKS5zb3J0KHlfZnVuTm1DbXByKVxyXG59XHJcbi8vIXkgPT09PT09PT09PT09PT09PT09PT1cclxuZXhwb3J0IGNvbnN0IHlfZnVuTm1DbXByID0gKGE6IHMsIGI6IHMpID0+IGNmLnZ2Q29tcGFyZShhLnJlcGxhY2UoL1xcXy9nLCAnICcpLCBiLnJlcGxhY2UoL1xcXy9nLCAnICcpKVxyXG5leHBvcnQgY29uc3QgeV9ubV9sdmxJID0gKG5tOiBubSkgPT4ge1xyXG4gICAgY29uc3QgYzAgPSBubVswXVxyXG4gICAgaWYgKGMwICE9PSAneCcgJiYgYzAgIT09ICd5JylcclxuICAgICAgICByZXR1cm4gLTFcclxuICAgIGNvbnN0IGl4ID0gbm0uaW5kZXhPZihcIl9cIilcclxuICAgIGlmIChpeCA9PT0gLTEpXHJcbiAgICAgICAgcmV0dXJuIC0xXHJcbiAgICByZXR1cm4gaXggLSAxXHJcbn1cclxuIl19