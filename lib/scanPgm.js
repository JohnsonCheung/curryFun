/// <reference path="./typings/node/node.d.ts"/>
'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
const cf = require("./curryfun.js");
const { pipe, rmvEmp, map } = cf;
//!export
exports.fjs_updMainTstIfStmt = (_fjs) => {
    const fTstJs = '';
    const fjs = '';
    x(fTstJs, fjs);
};
exports.fTstJs_updMainTstIfStmt = (_fTstJs) => {
    const fTstJs = '';
    const fjs = '';
    x(fTstJs, fjs);
};
//!x
const x = (_fTstJs, _fjs) => {
    // assume: [ module.id | function tst__* ]
    // aim:    [ upd module.id ]
    // assume[module.id]: each fts (*.ts-file), there is a statement of
    //       : if(module.id==='.') {
    //       : ..           <-- {context}
    //       : }
    // assume[function tst__*]: each fts, there are some /^function (tst__[\w$0-0_])\(\)/
    // aim:[upd module.id]: update the {context} by list of tst__xxxx
    const oldLines = cf.ftLines(_fts);
    const newLines = exports.xn_newLines(oldLines);
    const fTstTs = '';
    if (newLines !== null && newLines !== oldLines) {
        //cf.ffnMakBackup(_fts)
        cf.sWrt(fTstTs)(newLines);
    }
};
exports.xn_newLines = (newLines) => {
    const ly = cf.sSplitLines(newLines);
    const ix1 = exports.x1_ix1(ly);
    const ix2 = exports.x2_ix2(ly, ix1);
    if (ix1 === null || ix2 === null)
        return null;
    const p1 = exports.xn1_part1(ly, ix1);
    const p2 = exports.xn2_part2(tstSrc, ix1, ix2, src);
    const p3 = exports.xn3_part3(ly, ix2);
    return p1 + '\r\n' + p2 + '\r\n' + p3;
};
exports.x1e_eq = cf.vEQ("if (module.id === '.') {");
exports.x1_ix1 = (ly) => cf.ayFindIx(exports.x1e_eq)(ly);
exports.x2_ix2 = (ly, ix1) => {
    if (ix1 === null)
        return null;
    for (let ix = ix1 + 1; ix < ly.length; ix++) {
        if (ly[ix] === '}')
            return ix;
    }
    return null;
};
exports.xn1_part1 = (_src, ix1) => _src.slice(0, ix1 + 1).join('\r\n');
exports.xn2_part2 = (_tstSrc, ix1, ix2, _src) => {
    const tstNy = exports.tstSrc_srtedTstFunNy(_tstSrc);
    const expConstLy = exports.src_srtedExpConstLy(_src);
    const t1 = cf.itrAddPfxSfx('    ', '()')(tstNy);
    const f1 = cf.itrAddPfx('    ')(expConstLy);
    const n = t1.concat(f1);
    return n.join('\r\n');
};
exports.xn3_part3 = (ly, ix2) => ly.slice(ix2).join('\r\n');
exports.xn2fdbf_funNm = (_lin) => {
    const m = _lin.match(cf.reConstNm);
    if (m === null)
        return '';
    return m[1];
};
exports.xn2fdb_brk = (_lin) => {
    const funNm = exports.xn2fdbf_funNm(_lin);
    const rmk = exports.srcLin_rmk(_lin);
    return [funNm, rmk];
};
//!lib ===========
exports.tstSrc_srtedTstFunNy = yA;
exports.srcLin_rmk = (_lin) => {
    const m = _lin.match(/\/\/(.*)$/);
    if (m === null)
        return '';
    return m[1].trim();
};
exports.funNmCmpr = (a, b) => cf.vvCompare(a.replace(/\_/g, ' '), b.replace(/\_/g, ' '));
exports.funNm_lvlNo = (nm) => {
    const c0 = nm[0];
    if (c0 !== 'x' && c0 !== 'y')
        return -1;
    const ix = nm.indexOf("_");
    if (ix === -1)
        return -1;
    return ix - 1;
};
exports.src_expCOnstNy = (_src) => pipe(_src)(map(exports.lin_expConstNm), rmvEmp);
exports.lin_expConstNm = (_lin) => {
    const m = _lin.match(cf.reExpConstNm);
    return (m === null)
        ? null
        : m[1];
};
exports.expConstLin_constNm = (_expConstLin) => {
    const m0 = _expConstLin.match(cf.reExpConstNm);
    if (m0 !== null)
        return m0[1];
    const m1 = _expConstLin.match(cf.reConstNm);
    if (m1 !== null)
        return m1[1];
    cf.er('Given _funLin is not a function-line', { _expConstLin });
    return '';
};
exports.expConstLin_fmtLinPart2 = (_expConstin) => {
    const a0 = cf.sRmvPfx('export ')(_expConstin);
    const a1 = cf.sRmvPfx('const ')(a0);
    const a2 = cf.sRmvFstTerm(a1);
    return (a2 === '')
        ? ''
        : ' // ' + a2;
};
exports.src_expConstLy = (_src) => cf.itrWhere(exports.lin_isExpConstLin)(_src);
exports.lin_isExpConstLin = (_lin) => cf.reExpConstNm.test(_lin);
exports.src_srtedExpConstLy = (_src) => {
    const a = () => cf.srcExpConstNy(_src).sort(exports.funNmCmpr);
    const b = () => {
        const expConstLy = exports.src_expConstLy(_src);
        const expConstNy = cf.pipe(expConstLy)(cf.itrMap(exports.lin_expConstNm), cf.itrRmvEmp);
        const part2Ay = cf.itrMap(exports.expConstLin_fmtLinPart2)(expConstLy);
        const expConstNy1 = cf.itrAlignL(expConstNy);
        const lin = i => expConstNy1[i] + part2Ay[i];
        const ly = cf.itrMap(lin)(cf.nItr(expConstNy.length));
        return ly.sort(exports.funNmCmpr);
    };
    return true
        ? a()
        : b();
};
//!y ====================
exports.yAn_nLvl = (ny) => cf.itrMax(cf.itrMap(exports.funNm_lvlNo)(ny));
exports.yAli_isLvlINm = (_lvlI) => (_tstFunNm) => {
    const nm = cf.sRmvPfx('tst__')(_tstFunNm);
    const lvlI = exports.funNm_lvlNo(nm);
    const z = lvlI === _lvlI;
    return z;
};
exports.yAl_lvlINy = (lvlI, ny) => cf.itrWhere(exports.yAli_isLvlINm(lvlI))(ny).sort();
function yA(_tstSrc) {
    exports.tstSrc_srtedTstFunNy;
    const ny0 = cf.srcCol(/^function (tst__[$a-zA-Z][$_0-9a-zA-Z]*)\(\)/)(_tstSrc);
    const ny = cf.itrMap(cf.sRmvPfx("tst__"))(ny0);
    const n0 = exports.yAn_nLvl(ny);
    const n = cf.vDft(0)(n0);
    let o = [];
    for (let lvlI = n; lvlI >= -1; lvlI--) {
        const m = exports.yAl_lvlINy(lvlI, ny);
        o = o.concat(m);
    }
    if (ny.length !== o.length) {
        debugger;
        cf.er('ny.length should = o.length', { ny, o });
    }
    return o;
}
exports.yA = yA;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NhblBnbS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNjYW5QZ20udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsZ0RBQWdEO0FBQ2hELFlBQVksQ0FBQTs7QUFDWixvQ0FBbUM7QUFHbkMsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFBO0FBQ2hDLFNBQVM7QUFDSSxRQUFBLG9CQUFvQixHQUFHLENBQUMsSUFBUyxFQUFRLEVBQUU7SUFDcEQsTUFBTSxNQUFNLEdBQUcsRUFBRSxDQUFBO0lBQ2pCLE1BQU0sR0FBRyxHQUFHLEVBQUUsQ0FBQTtJQUNkLENBQUMsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUE7QUFDbEIsQ0FBQyxDQUFBO0FBQ1ksUUFBQSx1QkFBdUIsR0FBRyxDQUFDLE9BQWUsRUFBUSxFQUFFO0lBQzdELE1BQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQTtJQUNqQixNQUFNLEdBQUcsR0FBRyxFQUFFLENBQUE7SUFDZCxDQUFDLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0FBQ2xCLENBQUMsQ0FBQTtBQUNELElBQUk7QUFDSixNQUFNLENBQUMsR0FBRyxDQUFDLE9BQWUsRUFBRSxJQUFTLEVBQVEsRUFBRTtJQUMzQywwQ0FBMEM7SUFDMUMsNEJBQTRCO0lBQzVCLG1FQUFtRTtJQUNuRSxnQ0FBZ0M7SUFDaEMscUNBQXFDO0lBQ3JDLFlBQVk7SUFDWixxRkFBcUY7SUFDckYsaUVBQWlFO0lBQ2pFLE1BQU0sUUFBUSxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUE7SUFDakMsTUFBTSxRQUFRLEdBQUcsbUJBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQTtJQUN0QyxNQUFNLE1BQU0sR0FBRyxFQUFFLENBQUE7SUFDakIsRUFBRSxDQUFDLENBQUMsUUFBUSxLQUFLLElBQUksSUFBSSxRQUFRLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQztRQUM3Qyx1QkFBdUI7UUFDdkIsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQTtJQUM3QixDQUFDO0FBQ0wsQ0FBQyxDQUFBO0FBQ1ksUUFBQSxXQUFXLEdBQUcsQ0FBQyxRQUFlLEVBQWdCLEVBQUU7SUFDekQsTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQTtJQUNuQyxNQUFNLEdBQUcsR0FBRyxjQUFNLENBQUMsRUFBRSxDQUFDLENBQUE7SUFDdEIsTUFBTSxHQUFHLEdBQUcsY0FBTSxDQUFDLEVBQUUsRUFBRSxHQUFHLENBQUMsQ0FBQTtJQUMzQixFQUFFLENBQUMsQ0FBQyxHQUFHLEtBQUssSUFBSSxJQUFJLEdBQUcsS0FBSyxJQUFJLENBQUM7UUFDN0IsTUFBTSxDQUFDLElBQUksQ0FBQTtJQUNmLE1BQU0sRUFBRSxHQUFHLGlCQUFTLENBQUMsRUFBRSxFQUFFLEdBQWEsQ0FBQyxDQUFBO0lBQ3ZDLE1BQU0sRUFBRSxHQUFHLGlCQUFTLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUE7SUFDM0MsTUFBTSxFQUFFLEdBQUcsaUJBQVMsQ0FBQyxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUE7SUFDN0IsTUFBTSxDQUFDLEVBQUUsR0FBRyxNQUFNLEdBQUcsRUFBRSxHQUFHLE1BQU0sR0FBRyxFQUFFLENBQUE7QUFDekMsQ0FBQyxDQUFBO0FBRVksUUFBQSxNQUFNLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQywwQkFBMEIsQ0FBQyxDQUFBO0FBQzNDLFFBQUEsTUFBTSxHQUFHLENBQUMsRUFBTSxFQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLGNBQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFBO0FBQ2hELFFBQUEsTUFBTSxHQUFHLENBQUMsRUFBTSxFQUFFLEdBQU8sRUFBTSxFQUFFO0lBQzFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsS0FBSyxJQUFJLENBQUM7UUFDYixNQUFNLENBQUMsSUFBSSxDQUFBO0lBQ2YsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEdBQUcsR0FBRyxHQUFHLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLE1BQU0sRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDO1FBQzFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsS0FBSyxHQUFHLENBQUM7WUFDZixNQUFNLENBQUMsRUFBRSxDQUFBO0lBQ2pCLENBQUM7SUFDRCxNQUFNLENBQUMsSUFBSSxDQUFBO0FBQ2YsQ0FBQyxDQUFBO0FBQ1ksUUFBQSxTQUFTLEdBQUcsQ0FBQyxJQUFTLEVBQUUsR0FBTSxFQUFTLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO0FBQzdFLFFBQUEsU0FBUyxHQUFHLENBQUMsT0FBWSxFQUFFLEdBQU0sRUFBRSxHQUFNLEVBQUUsSUFBUyxFQUFTLEVBQUU7SUFDeEUsTUFBTSxLQUFLLEdBQUcsNEJBQW9CLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDM0MsTUFBTSxVQUFVLEdBQUcsMkJBQW1CLENBQUMsSUFBSSxDQUFDLENBQUE7SUFDNUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDL0MsTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQTtJQUMzQyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFBO0lBQ3ZCLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO0FBQ3pCLENBQUMsQ0FBQTtBQUNZLFFBQUEsU0FBUyxHQUFHLENBQUMsRUFBTSxFQUFFLEdBQU0sRUFBUyxFQUFFLENBQUMsRUFBRSxDQUFDLEtB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QUE7SUFDbkIsQ0FBQztJQUNELEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDekIsUUFBUSxDQUFBO1FBQ1IsRUFBRSxDQUFDLEVBQUUsQ0FBQyw2QkFBNkIsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFBO0lBQ25ELENBQUM7SUFDRCxNQUFNLENBQUMsQ0FBQyxDQUFBO0FBQ1osQ0FBQztBQWhCRCxnQkFnQkMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi90eXBpbmdzL25vZGUvbm9kZS5kLnRzXCIvPlxyXG4ndXNlIHN0cmljdCdcclxuaW1wb3J0ICogYXMgY2YgZnJvbSAnLi9jdXJyeWZ1bi5qcydcclxuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnXHJcbmltcG9ydCB7IEVOR0lORV9NRVRIT0RfUEtFWV9BU04xX01FVEhTIH0gZnJvbSAnY29uc3RhbnRzJztcclxuY29uc3QgeyBwaXBlLCBybXZFbXAsIG1hcCB9ID0gY2ZcclxuLy8hZXhwb3J0XHJcbmV4cG9ydCBjb25zdCBmanNfdXBkTWFpblRzdElmU3RtdCA9IChfZmpzOiBmanMpOiB2b2lkID0+IHtcclxuICAgIGNvbnN0IGZUc3RKcyA9ICcnXHJcbiAgICBjb25zdCBmanMgPSAnJ1xyXG4gICAgeChmVHN0SnMsIGZqcylcclxufVxyXG5leHBvcnQgY29uc3QgZlRzdEpzX3VwZE1haW5Uc3RJZlN0bXQgPSAoX2ZUc3RKczogZlRzdEpzKTogdm9pZCA9PiB7XHJcbiAgICBjb25zdCBmVHN0SnMgPSAnJ1xyXG4gICAgY29uc3QgZmpzID0gJydcclxuICAgIHgoZlRzdEpzLCBmanMpXHJcbn1cclxuLy8heFxyXG5jb25zdCB4ID0gKF9mVHN0SnM6IGZUc3RKcywgX2ZqczogZmpzKTogdm9pZCA9PiB7XHJcbiAgICAvLyBhc3N1bWU6IFsgbW9kdWxlLmlkIHwgZnVuY3Rpb24gdHN0X18qIF1cclxuICAgIC8vIGFpbTogICAgWyB1cGQgbW9kdWxlLmlkIF1cclxuICAgIC8vIGFzc3VtZVttb2R1bGUuaWRdOiBlYWNoIGZ0cyAoKi50cy1maWxlKSwgdGhlcmUgaXMgYSBzdGF0ZW1lbnQgb2ZcclxuICAgIC8vICAgICAgIDogaWYobW9kdWxlLmlkPT09Jy4nKSB7XHJcbiAgICAvLyAgICAgICA6IC4uICAgICAgICAgICA8LS0ge2NvbnRleHR9XHJcbiAgICAvLyAgICAgICA6IH1cclxuICAgIC8vIGFzc3VtZVtmdW5jdGlvbiB0c3RfXypdOiBlYWNoIGZ0cywgdGhlcmUgYXJlIHNvbWUgL15mdW5jdGlvbiAodHN0X19bXFx3JDAtMF9dKVxcKFxcKS9cclxuICAgIC8vIGFpbTpbdXBkIG1vZHVsZS5pZF06IHVwZGF0ZSB0aGUge2NvbnRleHR9IGJ5IGxpc3Qgb2YgdHN0X194eHh4XHJcbiAgICBjb25zdCBvbGRMaW5lcyA9IGNmLmZ0TGluZXMoX2Z0cylcclxuICAgIGNvbnN0IG5ld0xpbmVzID0geG5fbmV3TGluZXMob2xkTGluZXMpXHJcbiAgICBjb25zdCBmVHN0VHMgPSAnJ1xyXG4gICAgaWYgKG5ld0xpbmVzICE9PSBudWxsICYmIG5ld0xpbmVzICE9PSBvbGRMaW5lcykge1xyXG4gICAgICAgIC8vY2YuZmZuTWFrQmFja3VwKF9mdHMpXHJcbiAgICAgICAgY2Yuc1dydChmVHN0VHMpKG5ld0xpbmVzKVxyXG4gICAgfVxyXG59XHJcbmV4cG9ydCBjb25zdCB4bl9uZXdMaW5lcyA9IChuZXdMaW5lczogbGluZXMpOiBsaW5lcyB8IG51bGwgPT4ge1xyXG4gICAgY29uc3QgbHkgPSBjZi5zU3BsaXRMaW5lcyhuZXdMaW5lcylcclxuICAgIGNvbnN0IGl4MSA9IHgxX2l4MShseSlcclxuICAgIGNvbnN0IGl4MiA9IHgyX2l4MihseSwgaXgxKVxyXG4gICAgaWYgKGl4MSA9PT0gbnVsbCB8fCBpeDIgPT09IG51bGwpXHJcbiAgICAgICAgcmV0dXJuIG51bGxcclxuICAgIGNvbnN0IHAxID0geG4xX3BhcnQxKGx5LCBpeDEgYXMgbnVtYmVyKVxyXG4gICAgY29uc3QgcDIgPSB4bjJfcGFydDIodHN0U3JjLCBpeDEsIGl4Miwgc3JjKVxyXG4gICAgY29uc3QgcDMgPSB4bjNfcGFydDMobHksIGl4MilcclxuICAgIHJldHVybiBwMSArICdcXHJcXG4nICsgcDIgKyAnXFxyXFxuJyArIHAzXHJcbn1cclxudHlwZSBpeCA9IG51bWJlciB8IG51bGxcclxuZXhwb3J0IGNvbnN0IHgxZV9lcSA9IGNmLnZFUShcImlmIChtb2R1bGUuaWQgPT09ICcuJykge1wiKVxyXG5leHBvcnQgY29uc3QgeDFfaXgxID0gKGx5OiBseSk6IGl4ID0+IGNmLmF5RmluZEl4KHgxZV9lcSkobHkpXHJcbmV4cG9ydCBjb25zdCB4Ml9peDIgPSAobHk6IGx5LCBpeDE6IGl4KTogaXggPT4ge1xyXG4gICAgaWYgKGl4MSA9PT0gbnVsbClcclxuICAgICAgICByZXR1cm4gbnVsbFxyXG4gICAgZm9yIChsZXQgaXggPSBpeDEgKyAxOyBpeCA8IGx5Lmxlbmd0aDsgaXgrKykge1xyXG4gICAgICAgIGlmIChseVtpeF0gPT09ICd9JylcclxuICAgICAgICAgICAgcmV0dXJuIGl4XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbFxyXG59XHJcbmV4cG9ydCBjb25zdCB4bjFfcGFydDEgPSAoX3NyYzogc3JjLCBpeDE6IG4pOiBsaW5lcyA9PiBfc3JjLnNsaWNlKDAsIGl4MSArIDEpLmpvaW4oJ1xcclxcbicpXHJcbmV4cG9ydCBjb25zdCB4bjJfcGFydDIgPSAoX3RzdFNyYzogc3JjLCBpeDE6IG4sIGl4MjogbiwgX3NyYzogc3JjKTogbGluZXMgPT4ge1xyXG4gICAgY29uc3QgdHN0TnkgPSB0c3RTcmNfc3J0ZWRUc3RGdW5OeShfdHN0U3JjKVxyXG4gICAgY29uc3QgZXhwQ29uc3RMeSA9IHNyY19zcnRlZEV4cENvbnN0THkoX3NyYylcclxuICAgIGNvbnN0IHQxID0gY2YuaXRyQWRkUGZ4U2Z4KCcgICAgJywgJygpJykodHN0TnkpXHJcbiAgICBjb25zdCBmMSA9IGNmLml0ckFkZFBmeCgnICAgICcpKGV4cENvbnN0THkpXHJcbiAgICBjb25zdCBuID0gdDEuY29uY2F0KGYxKVxyXG4gICAgcmV0dXJuIG4uam9pbignXFxyXFxuJylcclxufVxyXG5leHBvcnQgY29uc3QgeG4zX3BhcnQzID0gKGx5OiBseSwgaXgyOiBuKTogbGluZXMgPT4gbHkuc2xpY2UoaXgyKS5qb2luKCdcXHJcXG4nKVxyXG5leHBvcnQgY29uc3QgeG4yZmRiZl9mdW5ObSA9IChfbGluOiBsaW4pOiBubSA9PiB7XHJcbiAgICBjb25zdCBtID0gX2xpbi5tYXRjaChjZi5yZUNvbnN0Tm0pXHJcbiAgICBpZiAobSA9PT0gbnVsbClcclxuICAgICAgICByZXR1cm4gJydcclxuICAgIHJldHVybiBtWzFdXHJcbn1cclxuZXhwb3J0IGNvbnN0IHhuMmZkYl9icmsgPSAoX2xpbjogbGluKTogW3MsIHNdID0+IHtcclxuICAgIGNvbnN0IGZ1bk5tID0geG4yZmRiZl9mdW5ObShfbGluKVxyXG4gICAgY29uc3Qgcm1rID0gc3JjTGluX3JtayhfbGluKVxyXG4gICAgcmV0dXJuIFtmdW5ObSwgcm1rXVxyXG59XHJcbi8vIWxpYiA9PT09PT09PT09PVxyXG5leHBvcnQgY29uc3QgdHN0U3JjX3NydGVkVHN0RnVuTnkgPSB5QVxyXG5leHBvcnQgY29uc3Qgc3JjTGluX3JtayA9IChfbGluOiBsaW4pOiBzID0+IHtcclxuICAgIGNvbnN0IG0gPSBfbGluLm1hdGNoKC9cXC9cXC8oLiopJC8pXHJcbiAgICBpZiAobSA9PT0gbnVsbClcclxuICAgICAgICByZXR1cm4gJydcclxuICAgIHJldHVybiBtWzFdLnRyaW0oKVxyXG59XHJcbmV4cG9ydCBjb25zdCBmdW5ObUNtcHIgPSAoYTogcywgYjogcykgPT4gY2YudnZDb21wYXJlKGEucmVwbGFjZSgvXFxfL2csICcgJyksIGIucmVwbGFjZSgvXFxfL2csICcgJykpXHJcbmV4cG9ydCBjb25zdCBmdW5ObV9sdmxObyA9IChubTogbm0pID0+IHtcclxuICAgIGNvbnN0IGMwID0gbm1bMF1cclxuICAgIGlmIChjMCAhPT0gJ3gnICYmIGMwICE9PSAneScpXHJcbiAgICAgICAgcmV0dXJuIC0xXHJcbiAgICBjb25zdCBpeCA9IG5tLmluZGV4T2YoXCJfXCIpXHJcbiAgICBpZiAoaXggPT09IC0xKVxyXG4gICAgICAgIHJldHVybiAtMVxyXG4gICAgcmV0dXJuIGl4IC0gMVxyXG59XHJcbmV4cG9ydCBjb25zdCBzcmNfZXhwQ09uc3ROeSA9IChfc3JjOiBzcmMpOiBueSA9PiBwaXBlKF9zcmMpKG1hcChsaW5fZXhwQ29uc3RObSksIHJtdkVtcClcclxuZXhwb3J0IGNvbnN0IGxpbl9leHBDb25zdE5tID0gKF9saW46IGxpbik6IG5tIHwgbnVsbCA9PiB7XHJcbiAgICBjb25zdCBtID0gX2xpbi5tYXRjaChjZi5yZUV4cENvbnN0Tm0pXHJcbiAgICByZXR1cm4gKG0gPT09IG51bGwpXHJcbiAgICAgICAgPyBudWxsXHJcbiAgICAgICAgOiBtWzFdXHJcbn1cclxuZXhwb3J0IGNvbnN0IGV4cENvbnN0TGluX2NvbnN0Tm0gPSAoX2V4cENvbnN0TGluOiBsaW4pOiBubSA9PiB7XHJcbiAgICBjb25zdCBtMCA9IF9leHBDb25zdExpbi5tYXRjaChjZi5yZUV4cENvbnN0Tm0pXHJcbiAgICBpZiAobTAgIT09IG51bGwpXHJcbiAgICAgICAgcmV0dXJuIG0wWzFdXHJcbiAgICBjb25zdCBtMSA9IF9leHBDb25zdExpbi5tYXRjaChjZi5yZUNvbnN0Tm0pXHJcbiAgICBpZiAobTEgIT09IG51bGwpXHJcbiAgICAgICAgcmV0dXJuIG0xWzFdXHJcbiAgICBjZi5lcignR2l2ZW4gX2Z1bkxpbiBpcyBub3QgYSBmdW5jdGlvbi1saW5lJywgeyBfZXhwQ29uc3RMaW4gfSlcclxuICAgIHJldHVybiAnJ1xyXG59XHJcbmV4cG9ydCBjb25zdCBleHBDb25zdExpbl9mbXRMaW5QYXJ0MiA9IChfZXhwQ29uc3RpbjogbGluKTogcyA9PiB7XHJcbiAgICBjb25zdCBhMCA9IGNmLnNSbXZQZngoJ2V4cG9ydCAnKShfZXhwQ29uc3RpbilcclxuICAgIGNvbnN0IGExID0gY2Yuc1JtdlBmeCgnY29uc3QgJykoYTApXHJcbiAgICBjb25zdCBhMiA9IGNmLnNSbXZGc3RUZXJtKGExKVxyXG4gICAgcmV0dXJuIChhMiA9PT0gJycpXHJcbiAgICAgICAgPyAnJ1xyXG4gICAgICAgIDogJyAvLyAnICsgYTJcclxufVxyXG5leHBvcnQgY29uc3Qgc3JjX2V4cENvbnN0THkgPSAoX3NyYzogc3JjKTogbHkgPT4gY2YuaXRyV2hlcmUobGluX2lzRXhwQ29uc3RMaW4pKF9zcmMpXHJcbmV4cG9ydCBjb25zdCBsaW5faXNFeHBDb25zdExpbiA9IChfbGluOiBsaW4pOiBiID0+IGNmLnJlRXhwQ29uc3RObS50ZXN0KF9saW4pXHJcbmV4cG9ydCBjb25zdCBzcmNfc3J0ZWRFeHBDb25zdEx5ID0gKF9zcmM6IHNyYyk6IGx5ID0+IHtcclxuICAgIGNvbnN0IGEgPSAoKSA9PiBjZi5zcmNFeHBDb25zdE55KF9zcmMpLnNvcnQoZnVuTm1DbXByKVxyXG4gICAgY29uc3QgYiA9ICgpID0+IHtcclxuICAgICAgICBjb25zdCBleHBDb25zdEx5ID0gc3JjX2V4cENvbnN0THkoX3NyYylcclxuICAgICAgICBjb25zdCBleHBDb25zdE55ID0gY2YucGlwZShleHBDb25zdEx5KShjZi5pdHJNYXAobGluX2V4cENvbnN0Tm0pLCBjZi5pdHJSbXZFbXApXHJcbiAgICAgICAgY29uc3QgcGFydDJBeSA9IGNmLml0ck1hcChleHBDb25zdExpbl9mbXRMaW5QYXJ0MikoZXhwQ29uc3RMeSlcclxuICAgICAgICBjb25zdCBleHBDb25zdE55MSA9IGNmLml0ckFsaWduTChleHBDb25zdE55KVxyXG4gICAgICAgIGNvbnN0IGxpbiA9IGkgPT4gZXhwQ29uc3ROeTFbaV0gKyBwYXJ0MkF5W2ldXHJcbiAgICAgICAgY29uc3QgbHkgPSBjZi5pdHJNYXAobGluKShjZi5uSXRyKGV4cENvbnN0TnkubGVuZ3RoKSlcclxuICAgICAgICByZXR1cm4gbHkuc29ydChmdW5ObUNtcHIpXHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRydWVcclxuICAgICAgICA/IGEoKVxyXG4gICAgICAgIDogYigpXHJcbn1cclxuLy8heSA9PT09PT09PT09PT09PT09PT09PVxyXG5leHBvcnQgY29uc3QgeUFuX25MdmwgPSAobnk6IG55KSA9PiBjZi5pdHJNYXgoY2YuaXRyTWFwKGZ1bk5tX2x2bE5vKShueSkpXHJcbmV4cG9ydCBjb25zdCB5QWxpX2lzTHZsSU5tID0gKF9sdmxJOiBuKSA9PiAoX3RzdEZ1bk5tOiBubSk6IGIgPT4ge1xyXG4gICAgY29uc3Qgbm0gPSBjZi5zUm12UGZ4KCd0c3RfXycpKF90c3RGdW5ObSlcclxuICAgIGNvbnN0IGx2bEkgPSBmdW5ObV9sdmxObyhubSlcclxuICAgIGNvbnN0IHogPSBsdmxJID09PSBfbHZsSVxyXG4gICAgcmV0dXJuIHpcclxufVxyXG5leHBvcnQgY29uc3QgeUFsX2x2bElOeSA9IChsdmxJOiBuLCBueTogbnkpOiBueSA9PiBjZi5pdHJXaGVyZSh5QWxpX2lzTHZsSU5tKGx2bEkpKShueSkuc29ydCgpXHJcbmV4cG9ydCBmdW5jdGlvbiB5QShfdHN0U3JjOiBzcmMpOiBubVtdIHtcclxuICAgIHRzdFNyY19zcnRlZFRzdEZ1bk55XHJcbiAgICBjb25zdCBueTAgPSBjZi5zcmNDb2woL15mdW5jdGlvbiAodHN0X19bJGEtekEtWl1bJF8wLTlhLXpBLVpdKilcXChcXCkvKShfdHN0U3JjKVxyXG4gICAgY29uc3QgbnkgPSBjZi5pdHJNYXAoY2Yuc1JtdlBmeChcInRzdF9fXCIpKShueTApXHJcbiAgICBjb25zdCBuMCA9IHlBbl9uTHZsKG55KVxyXG4gICAgY29uc3QgbiA9IGNmLnZEZnQoMCkobjApXHJcbiAgICBsZXQgbzogbnkgPSBbXVxyXG4gICAgZm9yIChsZXQgbHZsSSA9IG47IGx2bEkgPj0gLTE7IGx2bEktLSkge1xyXG4gICAgICAgIGNvbnN0IG0gPSB5QWxfbHZsSU55KGx2bEksIG55KVxyXG4gICAgICAgIG8gPSBvLmNvbmNhdChtKVxyXG4gICAgfVxyXG4gICAgaWYgKG55Lmxlbmd0aCAhPT0gby5sZW5ndGgpIHtcclxuICAgICAgICBkZWJ1Z2dlclxyXG4gICAgICAgIGNmLmVyKCdueS5sZW5ndGggc2hvdWxkID0gby5sZW5ndGgnLCB7IG55LCBvIH0pXHJcbiAgICB9XHJcbiAgICByZXR1cm4gb1xyXG59Il19